(function(e,t){if(typeof define==="function"&&define.amd){define(function(){return t(e)})}else if(typeof exports==="object"){module.exports=t}else{e.echo=t(e)}})(this,function(e){"use strict";var t={};var r=function(){};var n,o,a,c,i;var l=function(e){return e.offsetParent===null};var u=function(e,t){if(l(e)){return false}var r=e.getBoundingClientRect();return r.right>=t.l&&r.bottom>=t.t&&r.left<=t.r&&r.top<=t.b};var f=function(){if(!c&&!!o){return}clearTimeout(o);o=setTimeout(function(){t.render();o=null},a)};t.init=function(o){o=o||{};var l=o.offset||0;var u=o.offsetVertical||l;var d=o.offsetHorizontal||l;var s=function(e,t){return parseInt(e||t,10)};n={t:s(o.offsetTop,u),b:s(o.offsetBottom,u),l:s(o.offsetLeft,d),r:s(o.offsetRight,d)};a=s(o.throttle,250);c=o.debounce!==false;i=!!o.unload;r=o.callback||r;t.render();if(document.addEventListener){e.addEventListener("scroll",f,false);e.addEventListener("load",f,false)}else{e.attachEvent("onscroll",f);e.attachEvent("onload",f)}};t.render=function(o){var a=(o||document).querySelectorAll("[data-echo], [data-echo-background]");var c=a.length;var l,f;var d={l:0-n.l,t:0-n.t,b:(e.innerHeight||document.documentElement.clientHeight)+n.b,r:(e.innerWidth||document.documentElement.clientWidth)+n.r};for(var s=0;s<c;s++){f=a[s];if(u(f,d)){if(i){f.setAttribute("data-echo-placeholder",f.src)}if(f.getAttribute("data-echo-background")!==null){f.style.backgroundImage="url("+f.getAttribute("data-echo-background")+")"}else if(f.src!==(l=f.getAttribute("data-echo"))){f.src=l}if(!i){f.removeAttribute("data-echo");f.removeAttribute("data-echo-background")}r(f,"load")}else if(i&&!!(l=f.getAttribute("data-echo-placeholder"))){if(f.getAttribute("data-echo-background")!==null){f.style.backgroundImage="url("+l+")"}else{f.src=l}f.removeAttribute("data-echo-placeholder");r(f,"unload")}}if(!c){t.detach()}};t.detach=function(){if(document.removeEventListener){e.removeEventListener("scroll",f)}else{e.detachEvent("onscroll",f)}clearTimeout(o)};return t});